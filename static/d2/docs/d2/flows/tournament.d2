# Tournament Flow Diagrams
# D2 Documentation: https://d2lang.com

# Tournament Lifecycle
lifecycle: Tournament Lifecycle {
  direction: right
  
  create: Created {
    style.fill: "#e0e0e0"
  }
  
  upcoming: Upcoming {
    style.fill: "#bbdefb"
  }
  
  active: Active {
    style.fill: "#c8e6c9"
  }
  
  completed: Completed {
    style.fill: "#fff9c4"
  }
  
  cancelled: Cancelled {
    style.fill: "#ffcdd2"
  }
  
  create -> upcoming: Publish
  upcoming -> active: Start Time
  upcoming -> cancelled: Cancel
  active -> completed: End Time
  active -> cancelled: Cancel
}

# Participation Flow
participation: Participation Flow {
  direction: right
  
  start: Start {shape: oval}
  browse: Browse Tournaments
  select: Select Tournament
  
  eligible: Eligible? {shape: diamond}
  
  register: Register
  confirm: Confirm Registration
  wait: Wait for Start
  notify: Receive Notification
  
  started: Tournament Started? {shape: diamond}
  
  enter: Enter Match
  ready: Ready Screen (3-2-1)
  play: Play Match
  
  done: End {shape: oval}
  not_eligible: Show Requirements
  missed: Mark as Missed
  
  start -> browse -> select -> eligible
  eligible -> register: Yes
  eligible -> not_eligible: No
  not_eligible -> browse
  
  register -> confirm -> wait -> notify -> started
  started -> enter: Yes
  started -> missed: No (timeout)
  missed -> done
  
  enter -> ready -> play -> done
}

# Match Flow
match: Match Flow {
  direction: right
  
  start: Start {shape: oval}
  load: Load Questions
  show: Show Question
  timer: Start Timer
  
  answer: User Answers {
    select: Select Option
    skip: Skip
    timeout: Time Out
  }
  
  check: Check Answer
  update_score: Update Score
  next: Next Question
  
  more: More Questions? {shape: diamond}
  
  end: End Match
  calc: Calculate Final Score
  rank: Calculate Rank
  show_result: Show Result
  update_lb: Update Leaderboard
  
  done: End {shape: oval}
  
  start -> load -> show -> timer -> answer
  answer.select -> check
  answer.skip -> next
  answer.timeout -> check
  
  check -> update_score -> next -> more
  more -> show: Yes
  more -> end: No
  
  end -> calc -> rank -> show_result -> update_lb -> done
}

# Leaderboard Updates (Real-time)
leaderboard: Leaderboard System {
  direction: down
  
  match: Match Session
  
  events: Events {
    answer: Answer Submitted
    complete: Match Completed
  }
  
  processor: Score Processor {
    validate: Validate
    calculate: Calculate Points
    rank: Update Rank
  }
  
  broadcast: WebSocket Broadcast
  
  clients: Connected Clients {
    client1: User 1
    client2: User 2
    client3: User N
  }
  
  match -> events
  events -> processor
  processor -> broadcast
  broadcast -> clients
}

# Prize Distribution
prizes: Prize Distribution {
  direction: down
  
  tournament_end: Tournament Ends
  
  final_rank: Finalize Rankings {
    verify: Verify Scores
    resolve_ties: Resolve Ties
    lock: Lock Results
  }
  
  distribute: Distribute Prizes {
    top1: "Rank 1: 500 pts + Champion Badge"
    top2: "Rank 2: 300 pts + Runner-up Badge"
    top3: "Rank 3: 200 pts + Bronze Badge"
    top10: "Rank 4-10: 100 pts + Top 10 Badge"
    others: "Others: 10 pts (Participation)"
  }
  
  notify: Send Notifications
  
  tournament_end -> final_rank -> distribute -> notify
}
