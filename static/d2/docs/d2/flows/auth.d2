# Authentication Flow Diagrams
# D2 Documentation: https://d2lang.com

# Registration Flow
registration: Registration Flow {
  direction: right
  
  start: Start {shape: oval}
  form: Fill Registration Form
  validate: Validate Input
  check: Check Email/Phone Exists
  
  exists: Already Exists? {shape: diamond}
  
  create: Create Account
  send_otp: Send OTP
  verify: Enter OTP
  otp_valid: OTP Valid? {shape: diamond}
  
  activate: Activate Account
  onboard: Onboarding
  done: End {shape: oval}
  
  error_exists: Show Error
  error_otp: Show Error & Retry
  
  start -> form -> validate -> check -> exists
  exists -> create: No
  exists -> error_exists: Yes
  error_exists -> form
  
  create -> send_otp -> verify -> otp_valid
  otp_valid -> activate: Yes
  otp_valid -> error_otp: No
  error_otp -> verify
  
  activate -> onboard -> done
}

# Login Flow
login: Login Flow {
  direction: right
  
  start: Start {shape: oval}
  form: Enter Credentials
  validate: Validate Input
  auth: Authenticate
  
  success: Success? {shape: diamond}
  
  issue_token: Issue JWT
  store: Store Refresh Token
  redirect: Redirect to Dashboard
  done: End {shape: oval}
  
  check_attempts: Check Attempts
  locked: Account Locked? {shape: diamond}
  show_error: Show Error
  lock_account: Lock Account (15 min)
  
  start -> form -> validate -> auth -> success
  success -> issue_token: Yes
  success -> check_attempts: No
  
  issue_token -> store -> redirect -> done
  
  check_attempts -> locked
  locked -> show_error: No
  locked -> lock_account: Yes
  show_error -> form
  lock_account -> show_error
}

# Password Reset Flow
password_reset: Password Reset Flow {
  direction: right
  
  start: Start {shape: oval}
  request: Enter Email
  find: Find Account
  
  found: Found? {shape: diamond}
  
  send_link: Send Reset Link
  show_message: Show Success Message
  
  click_link: Click Link in Email
  valid: Link Valid? {shape: diamond}
  
  new_pass: Enter New Password
  update: Update Password
  confirm: Show Confirmation
  done: End {shape: oval}
  
  not_found: Show Generic Message
  expired: Show Expired Error
  
  start -> request -> find -> found
  found -> send_link: Yes
  found -> not_found: No
  not_found -> done
  
  send_link -> show_message -> click_link -> valid
  valid -> new_pass: Yes
  valid -> expired: No
  expired -> request
  
  new_pass -> update -> confirm -> done
}
