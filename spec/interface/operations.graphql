# =============================================================================
# LMS GraphQL Operations - Frontend Usage Examples
# =============================================================================
# This file contains common queries and mutations that FE will use.
# FE can copy/modify these or create new ones based on schema.graphql
# =============================================================================

# -----------------------------------------------------------------------------
# FRAGMENTS (reusable fields)
# -----------------------------------------------------------------------------

fragment UserBasic on User {
  id
  email
  status
  roles {
    role
  }
}

fragment LessonBasic on Lesson {
  id
  title
  status
}

fragment LessonFull on Lesson {
  id
  topicId
  title
  content
  status
  createdAt
  updatedAt
  topic {
    id
    name
    subject {
      id
      name
    }
  }
  media {
    id
    type
    url
  }
}

# -----------------------------------------------------------------------------
# AUTH OPERATIONS
# -----------------------------------------------------------------------------

mutation Login($input: LoginInput!) {
  login(input: $input) {
    accessToken
    refreshToken
    user {
      ...UserBasic
      profile {
        exp
        level
        coins
      }
    }
  }
}

mutation Register($input: RegisterInput!) {
  register(input: $input) {
    id
    email
    status
  }
}

mutation RefreshToken {
  refreshToken {
    accessToken
    refreshToken
    user {
      ...UserBasic
    }
  }
}

mutation Logout {
  logout
}

query GetMe {
  me {
    ...UserBasic
    tenantId
    tenant {
      id
      name
    }
    profile {
      exp
      level
      coins
    }
  }
}

query GetSessions {
  sessions {
    id
    deviceId
    lastActivity
    createdAt
  }
}

mutation RevokeSession($id: UUID!) {
  revokeSession(id: $id)
}

# -----------------------------------------------------------------------------
# CONTENT OPERATIONS
# -----------------------------------------------------------------------------

query GetSubjects {
  subjects {
    id
    name
    grade
    curriculum
  }
}

query GetTopics($subjectId: UUID) {
  topics(subjectId: $subjectId) {
    id
    name
    order
    subject {
      id
      name
    }
  }
}

query GetLessons($topicId: UUID) {
  lessons(topicId: $topicId) {
    ...LessonBasic
    topic {
      id
      name
    }
  }
}

query GetLesson($id: UUID!) {
  lesson(id: $id) {
    ...LessonFull
    questions {
      id
      type
      content
      answers {
        id
        text
      }
    }
  }
}

query SearchQuestions($query: String!, $type: QuestionType) {
  searchQuestions(query: $query, type: $type) {
    id
    type
    content
    lessonId
  }
}

# -----------------------------------------------------------------------------
# LEARNING OPERATIONS
# -----------------------------------------------------------------------------

query GetProgress {
  progress {
    id
    lessonId
    status
    score
    completedAt
    lesson {
      ...LessonBasic
    }
  }
}

query GetLearningPath($subjectId: UUID!) {
  learningPath(subjectId: $subjectId) {
    id
    lessons {
      ...LessonBasic
    }
  }
}

query GetLessonContent($id: UUID!) {
  lessonContent(id: $id) {
    ...LessonFull
  }
}

query GetLessonExercises($id: UUID!) {
  lessonExercises(id: $id) {
    id
    type
    content
    answers {
      id
      text
    }
  }
}

query GetRecommendations {
  recommendations {
    ...LessonBasic
    topic {
      id
      name
      subject {
        id
        name
      }
    }
  }
}

mutation CompleteLesson($id: UUID!) {
  completeLesson(id: $id) {
    id
    status
    score
    completedAt
  }
}

mutation SubmitExercise($lessonId: UUID!, $input: SubmitAnswersInput!) {
  submitExercise(lessonId: $lessonId, input: $input) {
    sessionId
    score
    correctCount
    totalCount
    results {
      questionId
      isCorrect
    }
  }
}

# -----------------------------------------------------------------------------
# GAMIFICATION OPERATIONS
# -----------------------------------------------------------------------------

query GetProfile {
  profile {
    userId
    exp
    level
    coins
    badges {
      badgeId
      earnedAt
      badge {
        id
        name
        icon
      }
    }
    streak {
      currentStreak
      longestStreak
    }
  }
}

query GetBadges {
  badges {
    badgeId
    earnedAt
    badge {
      id
      name
      criteria
      icon
    }
  }
}

query GetLeaderboard($limit: Int) {
  leaderboard(limit: $limit) {
    rank
    userId
    score
    user {
      id
      email
    }
  }
}

query GetRewards {
  rewards {
    id
    name
    cost
    type
    description
  }
}

query GetStreaks {
  streaks {
    currentStreak
    longestStreak
    lastActiveDate
  }
}

mutation RedeemReward($rewardId: UUID!) {
  redeemReward(rewardId: $rewardId) {
    id
    status
    reward {
      name
    }
  }
}

# -----------------------------------------------------------------------------
# ANALYTICS OPERATIONS
# -----------------------------------------------------------------------------

query GetProgressOverview {
  progressOverview {
    totalLessons
    completedLessons
    averageScore
    totalTimeSpent
    currentStreak
  }
}

query GetSubjectProgress($subjectId: UUID!) {
  subjectProgress(subjectId: $subjectId) {
    id
    lessonId
    status
    score
    lesson {
      ...LessonBasic
    }
  }
}

query GetKnowledgeMap {
  knowledgeMap {
    topicId
    masteryScore
    topic {
      id
      name
      subject {
        id
        name
      }
    }
  }
}

query GetDailyStats($startDate: DateTime, $endDate: DateTime) {
  dailyStats(startDate: $startDate, endDate: $endDate) {
    date
    lessonsCompleted
    timeSpent
    expEarned
  }
}

# -----------------------------------------------------------------------------
# TOURNAMENT OPERATIONS
# -----------------------------------------------------------------------------

query GetTournaments($status: TournamentStatus) {
  tournaments(status: $status) {
    id
    name
    type
    status
    startTime
    endTime
  }
}

query GetTournament($id: UUID!) {
  tournament(id: $id) {
    id
    name
    type
    status
    startTime
    endTime
    rounds {
      id
      order
      startTime
    }
    participants {
      userId
      score
      rank
      user {
        id
        email
      }
    }
  }
}

query GetTournamentLeaderboard($tournamentId: UUID!) {
  tournamentLeaderboard(tournamentId: $tournamentId) {
    userId
    score
    rank
    user {
      id
      email
    }
  }
}

mutation JoinTournament($tournamentId: UUID!) {
  joinTournament(tournamentId: $tournamentId) {
    id
    userId
    score
    rank
  }
}

mutation SubmitMatchAnswer($matchId: UUID!, $input: SubmitAnswersInput!) {
  submitMatchAnswer(matchId: $matchId, input: $input) {
    id
    score
    timeMs
  }
}

# -----------------------------------------------------------------------------
# NOTIFICATION OPERATIONS
# -----------------------------------------------------------------------------

query GetNotifications {
  notifications {
    id
    type
    content
    readAt
    createdAt
  }
}

mutation MarkNotificationRead($id: UUID!) {
  markNotificationRead(id: $id) {
    id
    readAt
  }
}

mutation DeleteNotification($id: UUID!) {
  deleteNotification(id: $id)
}

# -----------------------------------------------------------------------------
# SUBSCRIPTIONS
# -----------------------------------------------------------------------------

subscription OnNotification {
  notificationReceived {
    id
    type
    content
    createdAt
  }
}

subscription OnProgressUpdate {
  progressUpdated {
    id
    lessonId
    status
    score
  }
}

subscription OnTournamentLeaderboard($tournamentId: UUID!) {
  leaderboardUpdated(tournamentId: $tournamentId) {
    userId
    score
    rank
    user {
      id
      email
    }
  }
}
